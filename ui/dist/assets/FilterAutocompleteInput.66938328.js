import{S as z,i as Q,s as X,e as Y,f as Z,g as j,y as A,o as $,I as ee,J as te,K as ne,L as ie,M as oe,C as L,N as re}from"./index.be8ffbe5.js";import{C as E,E as x,a as w,h as se,b as le,c as ae,d as ue,e as ce,s as fe,f as de,g as he,i as ge,r as pe,j as ye,k as me,l as be,m as ke,n as xe,o as we,p as Se,q as Ce,t as U,S as qe}from"./index.9c8b95cd.js";function Ke(t){V(t,"start");var i={},e=t.languageData||{},d=!1;for(var h in t)if(h!=e&&t.hasOwnProperty(h))for(var p=i[h]=[],s=t[h],r=0;r<s.length;r++){var a=s[r];p.push(new Ie(a,t)),(a.indent||a.dedent)&&(d=!0)}return{name:e.name,startState:function(){return{state:"start",pending:null,indent:d?[]:null}},copyState:function(c){var m={state:c.state,pending:c.pending,indent:c.indent&&c.indent.slice(0)};return c.stack&&(m.stack=c.stack.slice(0)),m},token:ve(i),indent:Re(i,e),languageData:e}}function V(t,i){if(!t.hasOwnProperty(i))throw new Error("Undefined state "+i+" in simple mode")}function Le(t,i){if(!t)return/(?:)/;var e="";return t instanceof RegExp?(t.ignoreCase&&(e="i"),t=t.source):t=String(t),new RegExp((i===!1?"":"^")+"(?:"+t+")",e)}function Ee(t){if(!t)return null;if(t.apply)return t;if(typeof t=="string")return t.replace(/\./g," ");for(var i=[],e=0;e<t.length;e++)i.push(t[e]&&t[e].replace(/\./g," "));return i}function Ie(t,i){(t.next||t.push)&&V(i,t.next||t.push),this.regex=Le(t.regex),this.token=Ee(t.token),this.data=t}function ve(t){return function(i,e){if(e.pending){var d=e.pending.shift();return e.pending.length==0&&(e.pending=null),i.pos+=d.text.length,d.token}for(var h=t[e.state],p=0;p<h.length;p++){var s=h[p],r=(!s.data.sol||i.sol())&&i.match(s.regex);if(r){s.data.next?e.state=s.data.next:s.data.push?((e.stack||(e.stack=[])).push(e.state),e.state=s.data.push):s.data.pop&&e.stack&&e.stack.length&&(e.state=e.stack.pop()),s.data.indent&&e.indent.push(i.indentation()+i.indentUnit),s.data.dedent&&e.indent.pop();var a=s.token;if(a&&a.apply&&(a=a(r)),r.length>2&&s.token&&typeof s.token!="string"){e.pending=[];for(var c=2;c<r.length;c++)r[c]&&e.pending.push({text:r[c],token:s.token[c-1]});return i.backUp(r[0].length-(r[1]?r[1].length:0)),a[0]}else return a&&a.join?a[0]:a}}return i.next(),null}}function Re(t,i){return function(e,d){if(e.indent==null||i.dontIndentStates&&i.doneIndentState.indexOf(e.state)>-1)return null;var h=e.indent.length-1,p=t[e.state];e:for(;;){for(var s=0;s<p.length;s++){var r=p[s];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var a=r.regex.exec(d);if(a&&a[0]){h--,(r.next||r.push)&&(p=t[r.next||r.push]),d=d.slice(a[0].length);continue e}}}break}return h<0?0:e.indent[h]}}function Ae(t){let i;return{c(){i=Y("div"),Z(i,"class","code-editor")},m(e,d){j(e,i,d),t[13](i)},p:A,i:A,o:A,d(e){e&&$(i),t[13](null)}}}function _e(t,i,e){let d,h;ee(t,te,n=>e(12,h=n));const p=ne();let{id:s=""}=i,{value:r=""}=i,{disabled:a=!1}=i,{placeholder:c=""}=i,{baseCollection:m=new ie}=i,{singleLine:S=!1}=i,{extraAutocompleteKeys:I=[]}=i,{disableRequestKeys:k=!1}=i,{disableIndirectCollectionsKeys:C=!1}=i,f,b,_=new E,M=new E,O=new E,B=new E;function v(){f==null||f.focus()}function P(n){let o=n.slice();return L.pushOrReplaceByKey(o,m,"id"),o}function F(){b==null||b.dispatchEvent(new CustomEvent("change",{detail:{value:r},bubbles:!0}))}function W(){if(!s)return;const n=document.querySelectorAll('[for="'+s+'"]');for(let o of n)o.removeEventListener("click",v)}function D(){if(!s)return;W();const n=document.querySelectorAll('[for="'+s+'"]');for(let o of n)o.addEventListener("click",v)}function R(n,o="",l=0){let y=d.find(g=>g.name==n||g.id==n);if(!y||l>=4)return[];let u=[o+"id",o+"created",o+"updated"];y.isAuth&&(u.push(o+"username"),u.push(o+"email"),u.push(o+"emailVisibility"),u.push(o+"verified"));for(const g of y.schema){const q=o+g.name;if(u.push(q),g.type==="relation"&&g.options.collectionId){const K=R(g.options.collectionId,q+".",l+1);K.length&&(u=u.concat(K))}}return u}function H(n=!0,o=!0){let l=[].concat(I);const y=R(m.name);for(const u of y)l.push(u);if(n&&(l.push("@request.method"),l.push("@request.query."),l.push("@request.data."),l.push("@request.auth."),l.push("@request.auth.id"),l.push("@request.auth.collectionId"),l.push("@request.auth.collectionName"),l.push("@request.auth.username"),l.push("@request.auth.email"),l.push("@request.auth.emailVisibility"),l.push("@request.auth.verified"),l.push("@request.auth.created"),l.push("@request.auth.updated")),n||o)for(const u of d){let g="";if(!o)continue;g="@collection."+u.name+".";const q=R(u.name,g);for(const K of q)l.push(K)}return l.sort(function(u,g){return g.length-u.length}),l}function G(n){let o=n.matchBefore(/[\'\"\@\w\.]*/);if(o&&o.from==o.to&&!n.explicit)return null;let l=[{label:"false"},{label:"true"},{label:"@now"}];C||l.push({label:"@collection.*",apply:"@collection."});const y=H(!k,!k&&o.text.startsWith("@c"));for(const u of y)l.push({label:u.endsWith(".")?u+"*":u,apply:u});return{from:o.from,options:l}}function J(){const n=[{regex:L.escapeRegExp("@now"),token:"keyword"}],o=H(!k,!C);for(const l of o){let y;l.endsWith(".")?y=L.escapeRegExp(l)+"\\w+[\\w.]*":y=L.escapeRegExp(l),n.push({regex:y,token:"keyword"})}return n}function N(){return qe.define(Ke({start:[{regex:/true|false|null/,token:"atom"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}].concat(J())}))}oe(()=>{const n={key:"Enter",run:o=>{S&&p("submit",r)}};return D(),e(11,f=new x({parent:b,state:w.create({doc:r,extensions:[se(),le(),ae(),ue(),ce(),w.allowMultipleSelections.of(!0),fe(de,{fallback:!0}),he(),ge(),pe(),ye(),me.of([n,...be,...ke,xe.find(o=>o.key==="Mod-d"),...we,...Se]),x.lineWrapping,Ce({override:[G],icons:!1}),B.of(U(c)),M.of(x.editable.of(!0)),O.of(w.readOnly.of(!1)),_.of(N()),w.transactionFilter.of(o=>S&&o.newDoc.lines>1?[]:o),x.updateListener.of(o=>{!o.docChanged||a||(e(1,r=o.state.doc.toString()),F())})]})})),()=>{W(),f==null||f.destroy()}});function T(n){re[n?"unshift":"push"](()=>{b=n,e(0,b)})}return t.$$set=n=>{"id"in n&&e(2,s=n.id),"value"in n&&e(1,r=n.value),"disabled"in n&&e(3,a=n.disabled),"placeholder"in n&&e(4,c=n.placeholder),"baseCollection"in n&&e(5,m=n.baseCollection),"singleLine"in n&&e(6,S=n.singleLine),"extraAutocompleteKeys"in n&&e(7,I=n.extraAutocompleteKeys),"disableRequestKeys"in n&&e(8,k=n.disableRequestKeys),"disableIndirectCollectionsKeys"in n&&e(9,C=n.disableIndirectCollectionsKeys)},t.$$.update=()=>{t.$$.dirty&4096&&(d=P(h)),t.$$.dirty&4&&s&&D(),t.$$.dirty&2080&&f&&(m==null?void 0:m.schema)&&f.dispatch({effects:[_.reconfigure(N())]}),t.$$.dirty&2056&&f&&typeof a<"u"&&(f.dispatch({effects:[M.reconfigure(x.editable.of(!a)),O.reconfigure(w.readOnly.of(a))]}),F()),t.$$.dirty&2050&&f&&r!=f.state.doc.toString()&&f.dispatch({changes:{from:0,to:f.state.doc.length,insert:r}}),t.$$.dirty&2064&&f&&typeof c<"u"&&f.dispatch({effects:[B.reconfigure(U(c))]})},[b,r,s,a,c,m,S,I,k,C,v,f,h,T]}class Be extends z{constructor(i){super(),Q(this,i,_e,Ae,X,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10})}get focus(){return this.$$.ctx[10]}}export{Be as default};
