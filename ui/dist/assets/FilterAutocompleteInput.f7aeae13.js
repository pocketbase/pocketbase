import{S as z,i as Q,s as X,e as Y,f as Z,g as j,y as A,o as $,I as ee,J as te,K as ne,L as ie,M as oe,C,N as re}from"./index.e5a7196e.js";import{C as I,E as S,a as q,h as se,b as le,c as ae,d as ue,e as ce,s as fe,f as de,g as he,i as ge,r as pe,j as ye,k as me,l as be,m as ke,n as xe,o as we,p as Ce,q as Se,t as N,S as qe}from"./index.f6b93b13.js";function Ke(t){V(t,"start");var i={},e=t.languageData||{},d=!1;for(var g in t)if(g!=e&&t.hasOwnProperty(g))for(var p=i[g]=[],l=t[g],r=0;r<l.length;r++){var a=l[r];p.push(new Ie(a,t)),(a.indent||a.dedent)&&(d=!0)}return{name:e.name,startState:function(){return{state:"start",pending:null,indent:d?[]:null}},copyState:function(c){var m={state:c.state,pending:c.pending,indent:c.indent&&c.indent.slice(0)};return c.stack&&(m.stack=c.stack.slice(0)),m},token:ve(i),indent:Re(i,e),languageData:e}}function V(t,i){if(!t.hasOwnProperty(i))throw new Error("Undefined state "+i+" in simple mode")}function Le(t,i){if(!t)return/(?:)/;var e="";return t instanceof RegExp?(t.ignoreCase&&(e="i"),t=t.source):t=String(t),new RegExp((i===!1?"":"^")+"(?:"+t+")",e)}function Ee(t){if(!t)return null;if(t.apply)return t;if(typeof t=="string")return t.replace(/\./g," ");for(var i=[],e=0;e<t.length;e++)i.push(t[e]&&t[e].replace(/\./g," "));return i}function Ie(t,i){(t.next||t.push)&&V(i,t.next||t.push),this.regex=Le(t.regex),this.token=Ee(t.token),this.data=t}function ve(t){return function(i,e){if(e.pending){var d=e.pending.shift();return e.pending.length==0&&(e.pending=null),i.pos+=d.text.length,d.token}for(var g=t[e.state],p=0;p<g.length;p++){var l=g[p],r=(!l.data.sol||i.sol())&&i.match(l.regex);if(r){l.data.next?e.state=l.data.next:l.data.push?((e.stack||(e.stack=[])).push(e.state),e.state=l.data.push):l.data.pop&&e.stack&&e.stack.length&&(e.state=e.stack.pop()),l.data.indent&&e.indent.push(i.indentation()+i.indentUnit),l.data.dedent&&e.indent.pop();var a=l.token;if(a&&a.apply&&(a=a(r)),r.length>2&&l.token&&typeof l.token!="string"){e.pending=[];for(var c=2;c<r.length;c++)r[c]&&e.pending.push({text:r[c],token:l.token[c-1]});return i.backUp(r[0].length-(r[1]?r[1].length:0)),a[0]}else return a&&a.join?a[0]:a}}return i.next(),null}}function Re(t,i){return function(e,d){if(e.indent==null||i.dontIndentStates&&i.doneIndentState.indexOf(e.state)>-1)return null;var g=e.indent.length-1,p=t[e.state];e:for(;;){for(var l=0;l<p.length;l++){var r=p[l];if(r.data.dedent&&r.data.dedentIfLineStart!==!1){var a=r.regex.exec(d);if(a&&a[0]){g--,(r.next||r.push)&&(p=t[r.next||r.push]),d=d.slice(a[0].length);continue e}}}break}return g<0?0:e.indent[g]}}function Ae(t){let i;return{c(){i=Y("div"),Z(i,"class","code-editor")},m(e,d){j(e,i,d),t[13](i)},p:A,i:A,o:A,d(e){e&&$(i),t[13](null)}}}function _e(t,i,e){let d,g;ee(t,te,n=>e(12,g=n));const p=ne();let{id:l=""}=i,{value:r=""}=i,{disabled:a=!1}=i,{placeholder:c=""}=i,{baseCollection:m=new ie}=i,{singleLine:K=!1}=i,{extraAutocompleteKeys:v=[]}=i,{disableRequestKeys:w=!1}=i,{disableIndirectCollectionsKeys:L=!1}=i,f,b,_=new I,M=new I,O=new I,B=new I;function R(){f==null||f.focus()}function P(n){let o=n.slice();return C.pushOrReplaceByKey(o,m,"id"),o}function F(){b==null||b.dispatchEvent(new CustomEvent("change",{detail:{value:r},bubbles:!0}))}function W(){if(!l)return;const n=document.querySelectorAll('[for="'+l+'"]');for(let o of n)o.removeEventListener("click",R)}function D(){if(!l)return;W();const n=document.querySelectorAll('[for="'+l+'"]');for(let o of n)o.addEventListener("click",R)}function E(n,o="",s=0){let y=d.find(h=>h.name==n||h.id==n);if(!y||s>=4)return[];let u=[o+"id",o+"created",o+"updated"];y.isAuth&&(u.push(o+"username"),u.push(o+"email"),u.push(o+"emailVisibility"),u.push(o+"verified"));for(const h of y.schema){const k=o+h.name;if(u.push(k),h.type==="relation"&&h.options.collectionId){const x=E(h.options.collectionId,k+".",s+1);x.length&&(u=u.concat(x))}}return u}function U(n=!0,o=!0){let s=[].concat(v);const y=E(m.name);for(const u of y)s.push(u);if(n){s.push("@request.method"),s.push("@request.query."),s.push("@request.data."),s.push("@request.auth."),s.push("@request.auth.id"),s.push("@request.auth.collectionId"),s.push("@request.auth.collectionName"),s.push("@request.auth.verified"),s.push("@request.auth.username"),s.push("@request.auth.email"),s.push("@request.auth.emailVisibility"),s.push("@request.auth.created"),s.push("@request.auth.updated");const u=d.filter(h=>h.isAuth);for(const h of u){const k=E(h.id,"@request.auth.");for(const x of k)C.pushUnique(s,x)}}if(n||o)for(const u of d){let h="";if(!o)continue;h="@collection."+u.name+".";const k=E(u.name,h);for(const x of k)s.push(x)}return s.sort(function(u,h){return h.length-u.length}),s}function G(n){let o=n.matchBefore(/[\'\"\@\w\.]*/);if(o&&o.from==o.to&&!n.explicit)return null;let s=[{label:"false"},{label:"true"},{label:"@now"}];L||s.push({label:"@collection.*",apply:"@collection."});const y=U(!w,!w&&o.text.startsWith("@c"));for(const u of y)s.push({label:u.endsWith(".")?u+"*":u,apply:u});return{from:o.from,options:s}}function J(){const n=[{regex:C.escapeRegExp("@now"),token:"keyword"}],o=U(!w,!L);for(const s of o){let y;s.endsWith(".")?y=C.escapeRegExp(s)+"\\w+[\\w.]*":y=C.escapeRegExp(s),n.push({regex:y,token:"keyword"})}return n}function H(){return qe.define(Ke({start:[{regex:/true|false|null/,token:"atom"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}].concat(J())}))}oe(()=>{const n={key:"Enter",run:o=>{K&&p("submit",r)}};return D(),e(11,f=new S({parent:b,state:q.create({doc:r,extensions:[se(),le(),ae(),ue(),ce(),q.allowMultipleSelections.of(!0),fe(de,{fallback:!0}),he(),ge(),pe(),ye(),me.of([n,...be,...ke,xe.find(o=>o.key==="Mod-d"),...we,...Ce]),S.lineWrapping,Se({override:[G],icons:!1}),B.of(N(c)),M.of(S.editable.of(!0)),O.of(q.readOnly.of(!1)),_.of(H()),q.transactionFilter.of(o=>K&&o.newDoc.lines>1?[]:o),S.updateListener.of(o=>{!o.docChanged||a||(e(1,r=o.state.doc.toString()),F())})]})})),()=>{W(),f==null||f.destroy()}});function T(n){re[n?"unshift":"push"](()=>{b=n,e(0,b)})}return t.$$set=n=>{"id"in n&&e(2,l=n.id),"value"in n&&e(1,r=n.value),"disabled"in n&&e(3,a=n.disabled),"placeholder"in n&&e(4,c=n.placeholder),"baseCollection"in n&&e(5,m=n.baseCollection),"singleLine"in n&&e(6,K=n.singleLine),"extraAutocompleteKeys"in n&&e(7,v=n.extraAutocompleteKeys),"disableRequestKeys"in n&&e(8,w=n.disableRequestKeys),"disableIndirectCollectionsKeys"in n&&e(9,L=n.disableIndirectCollectionsKeys)},t.$$.update=()=>{t.$$.dirty&4096&&(d=P(g)),t.$$.dirty&4&&l&&D(),t.$$.dirty&2080&&f&&(m==null?void 0:m.schema)&&f.dispatch({effects:[_.reconfigure(H())]}),t.$$.dirty&2056&&f&&typeof a<"u"&&(f.dispatch({effects:[M.reconfigure(S.editable.of(!a)),O.reconfigure(q.readOnly.of(a))]}),F()),t.$$.dirty&2050&&f&&r!=f.state.doc.toString()&&f.dispatch({changes:{from:0,to:f.state.doc.length,insert:r}}),t.$$.dirty&2064&&f&&typeof c<"u"&&f.dispatch({effects:[B.reconfigure(N(c))]})},[b,r,l,a,c,m,K,v,w,L,R,f,g,T]}class Be extends z{constructor(i){super(),Q(this,i,_e,Ae,X,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10})}get focus(){return this.$$.ctx[10]}}export{Be as default};
