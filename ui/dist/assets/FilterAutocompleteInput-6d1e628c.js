import{S as se,i as ae,s as le,e as ue,f as ce,g as de,y as D,o as fe,J as he,K as ge,L as pe,I as ye,C as f,M as me}from"./index-16134c0b.js";import{E as C,a as q,h as ke,b as xe,c as be,d as we,e as Ee,s as Se,f as Ke,g as Ce,r as qe,i as Re,k as Ie,j as Le,l as ve,m as Ae,n as Oe,o as _e,p as Be,q as Y,C as L,S as Me,t as De,u as He}from"./index-b9ebaa6b.js";function Fe(e){Z(e,"start");var r={},n=e.languageData||{},p=!1;for(var y in e)if(y!=n&&e.hasOwnProperty(y))for(var h=r[y]=[],s=e[y],i=0;i<s.length;i++){var l=s[i];h.push(new We(l,e)),(l.indent||l.dedent)&&(p=!0)}return{name:n.name,startState:function(){return{state:"start",pending:null,indent:p?[]:null}},copyState:function(a){var x={state:a.state,pending:a.pending,indent:a.indent&&a.indent.slice(0)};return a.stack&&(x.stack=a.stack.slice(0)),x},token:Ne(r),indent:Je(r,n),languageData:n}}function Z(e,r){if(!e.hasOwnProperty(r))throw new Error("Undefined state "+r+" in simple mode")}function Te(e,r){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((r===!1?"":"^")+"(?:"+e+")",n)}function Ue(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var r=[],n=0;n<e.length;n++)r.push(e[n]&&e[n].replace(/\./g," "));return r}function We(e,r){(e.next||e.push)&&Z(r,e.next||e.push),this.regex=Te(e.regex),this.token=Ue(e.token),this.data=e}function Ne(e){return function(r,n){if(n.pending){var p=n.pending.shift();return n.pending.length==0&&(n.pending=null),r.pos+=p.text.length,p.token}for(var y=e[n.state],h=0;h<y.length;h++){var s=y[h],i=(!s.data.sol||r.sol())&&r.match(s.regex);if(i){s.data.next?n.state=s.data.next:s.data.push?((n.stack||(n.stack=[])).push(n.state),n.state=s.data.push):s.data.pop&&n.stack&&n.stack.length&&(n.state=n.stack.pop()),s.data.indent&&n.indent.push(r.indentation()+r.indentUnit),s.data.dedent&&n.indent.pop();var l=s.token;if(l&&l.apply&&(l=l(i)),i.length>2&&s.token&&typeof s.token!="string"){n.pending=[];for(var a=2;a<i.length;a++)i[a]&&n.pending.push({text:i[a],token:s.token[a-1]});return r.backUp(i[0].length-(i[1]?i[1].length:0)),l[0]}else return l&&l.join?l[0]:l}}return r.next(),null}}function Je(e,r){return function(n,p){if(n.indent==null||r.dontIndentStates&&r.doneIndentState.indexOf(n.state)>-1)return null;var y=n.indent.length-1,h=e[n.state];e:for(;;){for(var s=0;s<h.length;s++){var i=h[s];if(i.data.dedent&&i.data.dedentIfLineStart!==!1){var l=i.regex.exec(p);if(l&&l[0]){y--,(i.next||i.push)&&(h=e[i.next||i.push]),p=p.slice(l[0].length);continue e}}}break}return y<0?0:n.indent[y]}}function Pe(e){let r;return{c(){r=ue("div"),ce(r,"class","code-editor")},m(n,p){de(n,r,p),e[15](r)},p:D,i:D,o:D,d(n){n&&fe(r),e[15](null)}}}function Ve(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.schema])}function Ge(e,r,n){let p;he(e,ge,t=>n(21,p=t));const y=pe();let{id:h=""}=r,{value:s=""}=r,{disabled:i=!1}=r,{placeholder:l=""}=r,{baseCollection:a=null}=r,{singleLine:x=!1}=r,{extraAutocompleteKeys:v=[]}=r,{disableRequestKeys:E=!1}=r,{disableIndirectCollectionsKeys:S=!1}=r,d,b,A=i,H=new L,F=new L,T=new L,U=new L,R=[],W=[],N=[],J=[],I="",O="";function _(){d==null||d.focus()}let B=null;function j(){clearTimeout(B),B=setTimeout(()=>{R=$(p),J=ee(),W=E?[]:te(),N=S?[]:ne()},300)}function $(t){let o=t.slice();return a&&f.pushOrReplaceByKey(o,a,"id"),o}function P(){b==null||b.dispatchEvent(new CustomEvent("change",{detail:{value:s},bubbles:!0}))}function V(){if(!h)return;const t=document.querySelectorAll('[for="'+h+'"]');for(let o of t)o.removeEventListener("click",_)}function G(){if(!h)return;V();const t=document.querySelectorAll('[for="'+h+'"]');for(let o of t)o.addEventListener("click",_)}function K(t,o="",u=0){var m,w,Q;let c=R.find(k=>k.name==t||k.id==t);if(!c||u>=4)return[];let g=f.getAllCollectionIdentifiers(c,o);for(const k of(c==null?void 0:c.schema)||[]){const M=o+k.name;if(k.type==="relation"&&((m=k.options)!=null&&m.collectionId)){const X=K(k.options.collectionId,M+".",u+1);X.length&&(g=g.concat(X))}k.type==="select"&&((w=k.options)==null?void 0:w.maxSelect)!=1&&g.push(M+":each"),((Q=k.options)==null?void 0:Q.maxSelect)!=1&&["select","file","relation"].includes(k.type)&&g.push(M+":length")}return g}function ee(){return K(a==null?void 0:a.name)}function te(){const t=[];t.push("@request.method"),t.push("@request.query."),t.push("@request.data."),t.push("@request.headers."),t.push("@request.auth.id"),t.push("@request.auth.collectionId"),t.push("@request.auth.collectionName"),t.push("@request.auth.verified"),t.push("@request.auth.username"),t.push("@request.auth.email"),t.push("@request.auth.emailVisibility"),t.push("@request.auth.created"),t.push("@request.auth.updated");const o=R.filter(c=>c.type==="auth");for(const c of o){const g=K(c.id,"@request.auth.");for(const m of g)f.pushUnique(t,m)}const u=["created","updated"];if(a!=null&&a.id){const c=K(a.name,"@request.data.");for(const g of c){t.push(g);const m=g.split(".");m.length===3&&m[2].indexOf(":")===-1&&!u.includes(m[2])&&t.push(g+":isset")}}return t}function ne(){const t=[];for(const o of R){const u="@collection."+o.name+".",c=K(o.name,u);for(const g of c)t.push(g)}return t}function re(t=!0,o=!0){let u=[].concat(v);return u=u.concat(J||[]),t&&(u=u.concat(W||[])),o&&(u=u.concat(N||[])),u.sort(function(c,g){return g.length-c.length}),u}function ie(t){var m;let o=t.matchBefore(/[\'\"\@\w\.]*/);if(o&&o.from==o.to&&!t.explicit)return null;let u=He(t.state).resolveInner(t.pos,-1);if(((m=u==null?void 0:u.type)==null?void 0:m.name)=="comment")return null;let c=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];S||c.push({label:"@collection.*",apply:"@collection."});const g=re(!E,!E&&o.text.startsWith("@c"));for(const w of g)c.push({label:w.endsWith(".")?w+"*":w,apply:w});return{from:o.from,options:c}}function z(){return Me.define(Fe({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:f.escapeRegExp("@now"),token:"keyword"},{regex:f.escapeRegExp("@second"),token:"keyword"},{regex:f.escapeRegExp("@minute"),token:"keyword"},{regex:f.escapeRegExp("@hour"),token:"keyword"},{regex:f.escapeRegExp("@year"),token:"keyword"},{regex:f.escapeRegExp("@day"),token:"keyword"},{regex:f.escapeRegExp("@month"),token:"keyword"},{regex:f.escapeRegExp("@weekday"),token:"keyword"},{regex:f.escapeRegExp("@todayStart"),token:"keyword"},{regex:f.escapeRegExp("@todayEnd"),token:"keyword"},{regex:f.escapeRegExp("@monthStart"),token:"keyword"},{regex:f.escapeRegExp("@monthEnd"),token:"keyword"},{regex:f.escapeRegExp("@yearStart"),token:"keyword"},{regex:f.escapeRegExp("@yearEnd"),token:"keyword"},{regex:f.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}ye(()=>{const t={key:"Enter",run:o=>{x&&y("submit",s)}};return G(),n(11,d=new C({parent:b,state:q.create({doc:s,extensions:[ke(),xe(),be(),we(),Ee(),q.allowMultipleSelections.of(!0),Se(De,{fallback:!0}),Ke(),Ce(),qe(),Re(),Ie.of([t,...Le,...ve,Ae.find(o=>o.key==="Mod-d"),...Oe,..._e]),C.lineWrapping,Be({override:[ie],icons:!1}),U.of(Y(l)),F.of(C.editable.of(!i)),T.of(q.readOnly.of(i)),H.of(z()),q.transactionFilter.of(o=>x&&o.newDoc.lines>1?[]:o),C.updateListener.of(o=>{!o.docChanged||i||(n(1,s=o.state.doc.toString()),P())})]})})),()=>{clearTimeout(B),V(),d==null||d.destroy()}});function oe(t){me[t?"unshift":"push"](()=>{b=t,n(0,b)})}return e.$$set=t=>{"id"in t&&n(2,h=t.id),"value"in t&&n(1,s=t.value),"disabled"in t&&n(3,i=t.disabled),"placeholder"in t&&n(4,l=t.placeholder),"baseCollection"in t&&n(5,a=t.baseCollection),"singleLine"in t&&n(6,x=t.singleLine),"extraAutocompleteKeys"in t&&n(7,v=t.extraAutocompleteKeys),"disableRequestKeys"in t&&n(8,E=t.disableRequestKeys),"disableIndirectCollectionsKeys"in t&&n(9,S=t.disableIndirectCollectionsKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&n(13,I=Ve(a)),e.$$.dirty[0]&25352&&!i&&(O!=I||E!==-1||S!==-1)&&(n(14,O=I),j()),e.$$.dirty[0]&4&&h&&G(),e.$$.dirty[0]&2080&&d&&a!=null&&a.schema&&d.dispatch({effects:[H.reconfigure(z())]}),e.$$.dirty[0]&6152&&d&&A!=i&&(d.dispatch({effects:[F.reconfigure(C.editable.of(!i)),T.reconfigure(q.readOnly.of(i))]}),n(12,A=i),P()),e.$$.dirty[0]&2050&&d&&s!=d.state.doc.toString()&&d.dispatch({changes:{from:0,to:d.state.doc.length,insert:s}}),e.$$.dirty[0]&2064&&d&&typeof l<"u"&&d.dispatch({effects:[U.reconfigure(Y(l))]})},[b,s,h,i,l,a,x,v,E,S,_,d,A,I,O,oe]}class Xe extends se{constructor(r){super(),ae(this,r,Ge,Pe,le,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableIndirectCollectionsKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Xe as default};
