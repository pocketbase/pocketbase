import{S as ie,i as le,s as se,H as M,h as ce,l as de,u as fe,w as ue,O as X,T as ge,U as he,V as ye,Q as pe,J as u,y as ke}from"./index-XoocRngl.js";import{H as me,t as p,c as be,d as xe,s as we,h as Se,a as Ee,E as C,b as K,e as Ce,f as Ke,g as Re,i as Le,j as qe,C as R,k as De,l as He,r as Oe,m as Te,n as We,o as _e,p as D,q as Y,u as ve,S as Me,v as Z,w as Je}from"./index-kK8mJ5Fg.js";function Ae(e){return new Worker(""+new URL("autocomplete.worker-Bb6Toth-.js",import.meta.url).href,{name:e==null?void 0:e.name})}function Be(e){$(e,"start");var r={},t=e.languageData||{},f=!1;for(var g in e)if(g!=t&&e.hasOwnProperty(g))for(var y=r[g]=[],i=e[g],a=0;a<i.length;a++){var o=i[a];y.push(new Fe(o,e)),(o.indent||o.dedent)&&(f=!0)}return{name:t.name,startState:function(){return{state:"start",pending:null,indent:f?[]:null}},copyState:function(c){var h={state:c.state,pending:c.pending,indent:c.indent&&c.indent.slice(0)};return c.stack&&(h.stack=c.stack.slice(0)),h},token:Ne(r),indent:Pe(r,t),mergeTokens:t.mergeTokens,languageData:t}}function $(e,r){if(!e.hasOwnProperty(r))throw new Error("Undefined state "+r+" in simple mode")}function Ie(e,r){if(!e)return/(?:)/;var t="";return e instanceof RegExp?(e.ignoreCase&&(t="i"),e.unicode&&(t+="u"),e=e.source):e=String(e),new RegExp("^(?:"+e+")",t)}function Ue(e){if(!e)return null;if(e.apply)return e;if(typeof e=="string")return e.replace(/\./g," ");for(var r=[],t=0;t<e.length;t++)r.push(e[t]&&e[t].replace(/\./g," "));return r}function Fe(e,r){(e.next||e.push)&&$(r,e.next||e.push),this.regex=Ie(e.regex),this.token=Ue(e.token),this.data=e}function Ne(e){return function(r,t){if(t.pending){var f=t.pending.shift();return t.pending.length==0&&(t.pending=null),r.pos+=f.text.length,f.token}for(var g=e[t.state],y=0;y<g.length;y++){var i=g[y],a=(!i.data.sol||r.sol())&&r.match(i.regex);if(a){i.data.next?t.state=i.data.next:i.data.push?((t.stack||(t.stack=[])).push(t.state),t.state=i.data.push):i.data.pop&&t.stack&&t.stack.length&&(t.state=t.stack.pop()),i.data.indent&&t.indent.push(r.indentation()+r.indentUnit),i.data.dedent&&t.indent.pop();var o=i.token;if(o&&o.apply&&(o=o(a)),a.length>2&&i.token&&typeof i.token!="string"){t.pending=[];for(var c=2;c<a.length;c++)a[c]&&t.pending.push({text:a[c],token:i.token[c-1]});return r.backUp(a[0].length-(a[1]?a[1].length:0)),o[0]}else return o&&o.join?o[0]:o}}return r.next(),null}}function Pe(e,r){return function(t,f){if(t.indent==null||r.dontIndentStates&&r.dontIndentStates.indexOf(t.state)>-1)return null;var g=t.indent.length-1,y=e[t.state];e:for(;;){for(var i=0;i<y.length;i++){var a=y[i];if(a.data.dedent&&a.data.dedentIfLineStart!==!1){var o=a.regex.exec(f);if(o&&o[0]){g--,(a.next||a.push)&&(y=e[a.next||a.push]),f=f.slice(o[0].length);continue e}}}break}return g<0?0:t.indent[g]}}function Ve(e){let r;return{c(){r=fe("div"),ue(r,"class","code-editor")},m(t,f){de(t,r,f),e[16](r)},p:M,i:M,o:M,d(t){t&&ce(r),e[16](null)}}}function Ge(e){return JSON.stringify([e==null?void 0:e.name,e==null?void 0:e.type,e==null?void 0:e.fields])}function Qe(e,r,t){let f,g;X(e,ge,n=>t(15,f=n)),X(e,he,n=>t(22,g=n));const y=ye();let{id:i=""}=r,{value:a=""}=r,{disabled:o=!1}=r,{placeholder:c=""}=r,{baseCollection:h=null}=r,{singleLine:w=!1}=r,{extraAutocompleteKeys:H=[]}=r,{disableRequestKeys:S=!1}=r,{disableCollectionJoinKeys:b=!1}=r,s,k,O=o,J=new R,A=new R,B=new R,I=new R,U=new R,T=new Ae,F=[],N=[],P=[],L="",W="";function _(){s==null||s.focus()}let v=null;T.onmessage=n=>{P=n.data.baseKeys||[],F=n.data.requestKeys||[],N=n.data.collectionJoinKeys||[]};function ee(){clearTimeout(v),v=setTimeout(()=>{T.postMessage({baseCollection:h,collections:te(g),disableRequestKeys:S,disableCollectionJoinKeys:b})},250)}function te(n){let d=n.slice();return h&&u.pushOrReplaceByKey(d,h,"id"),d}function V(){k==null||k.dispatchEvent(new CustomEvent("change",{detail:{value:a},bubbles:!0}))}function G(){if(!i)return;const n=document.querySelectorAll('[for="'+i+'"]');for(let d of n)d.removeEventListener("click",_)}function Q(){if(!i)return;G();const n=document.querySelectorAll('[for="'+i+'"]');for(let d of n)d.addEventListener("click",_)}function ne(n=!0,d=!0){let l=[].concat(H);return l=l.concat(P||[]),n&&(l=l.concat(F||[])),d&&(l=l.concat(N||[])),l}function re(n){var E;let d=n.matchBefore(/[\'\"\@\w\.]*/);if(d&&d.from==d.to&&!n.explicit)return null;let l=Je(n.state).resolveInner(n.pos,-1);if(((E=l==null?void 0:l.type)==null?void 0:E.name)=="comment")return null;let x=[{label:"false"},{label:"true"},{label:"@now"},{label:"@second"},{label:"@minute"},{label:"@hour"},{label:"@year"},{label:"@day"},{label:"@month"},{label:"@weekday"},{label:"@yesterday"},{label:"@tomorrow"},{label:"@todayStart"},{label:"@todayEnd"},{label:"@monthStart"},{label:"@monthEnd"},{label:"@yearStart"},{label:"@yearEnd"}];b||x.push({label:"@collection.*",apply:"@collection."});let q=ne(!S&&d.text.startsWith("@r"),!b&&d.text.startsWith("@c"));for(const m of q)x.push({label:m.endsWith(".")?m+"*":m,apply:m,boost:m.indexOf("_via_")>0?-1:0});return{from:d.from,options:x}}function j(){return Me.define(Be({start:[{regex:/true|false|null/,token:"atom"},{regex:/\/\/.*/,token:"comment"},{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"string"},{regex:/'(?:[^\\]|\\.)*?(?:'|$)/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\&\&|\|\||\=|\!\=|\~|\!\~|\>|\<|\>\=|\<\=/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/\w+[\w\.]*\w+/,token:"keyword"},{regex:u.escapeRegExp("@now"),token:"keyword"},{regex:u.escapeRegExp("@second"),token:"keyword"},{regex:u.escapeRegExp("@minute"),token:"keyword"},{regex:u.escapeRegExp("@hour"),token:"keyword"},{regex:u.escapeRegExp("@year"),token:"keyword"},{regex:u.escapeRegExp("@day"),token:"keyword"},{regex:u.escapeRegExp("@month"),token:"keyword"},{regex:u.escapeRegExp("@weekday"),token:"keyword"},{regex:u.escapeRegExp("@todayStart"),token:"keyword"},{regex:u.escapeRegExp("@todayEnd"),token:"keyword"},{regex:u.escapeRegExp("@monthStart"),token:"keyword"},{regex:u.escapeRegExp("@monthEnd"),token:"keyword"},{regex:u.escapeRegExp("@yearStart"),token:"keyword"},{regex:u.escapeRegExp("@yearEnd"),token:"keyword"},{regex:u.escapeRegExp("@request.method"),token:"keyword"}],meta:{lineComment:"//"}}))}const z=me.define([{tag:p.comment,color:"#89949b",fontStyle:"italic"},{tag:p.keyword,color:"#5499e8"},{tag:p.operator,color:"#dcdcdc"},{tag:p.string,color:"#32ad84"},{tag:p.number,color:"#e34562"},{tag:p.atom,color:"#e34562"},{tag:p.punctuation,color:"#a0a6ac"},{tag:p.variableName,color:"#dcdcdc"}]);pe(()=>{const n={key:"Enter",run:l=>{w&&y("submit",a)}};Q();let d=[n,...be,...xe,we.find(l=>l.key==="Mod-d"),...Se,...Ee];return w||d.push(ve),t(11,s=new C({parent:k,state:K.create({doc:a,extensions:[Ce(),Ke(),Re(),Le(),qe(),K.allowMultipleSelections.of(!0),U.of(f?D(z,{fallback:!0}):D(Z,{fallback:!0})),De(),He(),Oe(),Te(),We.of(d),C.lineWrapping,_e({override:[re],icons:!1}),I.of(Y(c)),A.of(C.editable.of(!o)),B.of(K.readOnly.of(o)),J.of(j()),K.transactionFilter.of(l=>{var x,q,E;if(w&&l.newDoc.lines>1){if(!((E=(q=(x=l.changes)==null?void 0:x.inserted)==null?void 0:q.filter(m=>!!m.text.find(oe=>oe)))!=null&&E.length))return[];l.newDoc.text=[l.newDoc.text.join(" ")]}return l}),C.updateListener.of(l=>{!l.docChanged||o||(t(1,a=l.state.doc.toString()),V())})]})})),()=>{clearTimeout(v),G(),s==null||s.destroy(),T.terminate()}});function ae(n){ke[n?"unshift":"push"](()=>{k=n,t(0,k)})}return e.$$set=n=>{"id"in n&&t(2,i=n.id),"value"in n&&t(1,a=n.value),"disabled"in n&&t(3,o=n.disabled),"placeholder"in n&&t(4,c=n.placeholder),"baseCollection"in n&&t(5,h=n.baseCollection),"singleLine"in n&&t(6,w=n.singleLine),"extraAutocompleteKeys"in n&&t(7,H=n.extraAutocompleteKeys),"disableRequestKeys"in n&&t(8,S=n.disableRequestKeys),"disableCollectionJoinKeys"in n&&t(9,b=n.disableCollectionJoinKeys)},e.$$.update=()=>{e.$$.dirty[0]&32&&t(13,L=Ge(h)),e.$$.dirty[0]&25352&&!o&&(W!=L||S!==-1||b!==-1)&&(t(14,W=L),ee()),e.$$.dirty[0]&4&&i&&Q(),e.$$.dirty[0]&2080&&s&&h!=null&&h.fields&&s.dispatch({effects:[J.reconfigure(j())]}),e.$$.dirty[0]&6152&&s&&O!=o&&(s.dispatch({effects:[A.reconfigure(C.editable.of(!o)),B.reconfigure(K.readOnly.of(o))]}),t(12,O=o),V()),e.$$.dirty[0]&2050&&s&&a!=s.state.doc.toString()&&s.dispatch({changes:{from:0,to:s.state.doc.length,insert:a}}),e.$$.dirty[0]&2064&&s&&typeof c<"u"&&s.dispatch({effects:[I.reconfigure(Y(c))]}),e.$$.dirty[0]&34816&&s&&s.dispatch({effects:[U.reconfigure(f?D(z,{fallback:!0}):D(Z,{fallback:!0}))]})},[k,a,i,o,c,h,w,H,S,b,_,s,O,L,W,f,ae]}class Xe extends ie{constructor(r){super(),le(this,r,Qe,Ve,se,{id:2,value:1,disabled:3,placeholder:4,baseCollection:5,singleLine:6,extraAutocompleteKeys:7,disableRequestKeys:8,disableCollectionJoinKeys:9,focus:10},null,[-1,-1])}get focus(){return this.$$.ctx[10]}}export{Xe as default};
